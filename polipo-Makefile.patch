--- b/Makefile	2007-03-06 20:29:05.000000000 +0100
+++ n/Makefile	2007-03-25 12:57:54.037181859 +0200
@@ -1,9 +1,15 @@
+PKGNAME = polipo
 PREFIX = /usr/local
 BINDIR = $(PREFIX)/bin
-MANDIR = $(PREFIX)/man
-INFODIR = $(PREFIX)/info
-LOCAL_ROOT = /usr/share/polipo/www
-DISK_CACHE_ROOT = /var/cache/polipo
+DATADIR = $(PREFIX)/share
+MANDIR = $(DATADIR)/man
+INFODIR = $(DATADIR)/info
+PKGDATADIR = $(DATADIR)/$(PKGNAME)
+LOCAL_ROOT = $(PKGDATADIR)/www
+LOCALSTATEDIR = /var
+DISK_CACHE_ROOT = $(LOCALSTATEDIR)/cache/$(PKGNAME)
+
+PATH += :/usr/sbin
 
 # To compile with Unix CC:
 
@@ -12,8 +18,10 @@
 # To compile with GCC:
 
 # CC = gcc
+CFLAGS = -O2
+override CFLAGS += -Wall
 # CDEBUGFLAGS = -Os -g -Wall -std=gnu99
-CDEBUGFLAGS = -Os -g -Wall
+# CDEBUGFLAGS = -Os -g -Wall
 # CDEBUGFLAGS = -Os -Wall
 # CDEBUGFLAGS = -g -Wall
 
@@ -62,8 +70,6 @@
 
 DEFINES = $(FILE_DEFINES) $(PLATFORM_DEFINES)
 
-CFLAGS = $(MD5INCLUDES) $(CDEBUGFLAGS) $(DEFINES) $(EXTRA_DEFINES)
-
 SRCS = util.c event.c io.c chunk.c atom.c object.c log.c diskcache.c main.c \
        config.c local.c http.c client.c server.c auth.c tunnel.c \
        http_parse.c parse_time.c dns.c forbidden.c \
@@ -75,7 +81,7 @@
        md5import.o ftsimport.o socks.o mingw.o
 
 polipo$(EXE): $(OBJS)
-	$(CC) $(CFLAGS) $(LDFLAGS) -o polipo$(EXE) $(OBJS) $(MD5LIBS) $(LDLIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) $(MD5INCLUDES) $(DEFINES) $(EXTRA_DEFINES) -o polipo$(EXE) $(OBJS) $(MD5LIBS) $(LDLIBS)
 
 ftsimport.o: ftsimport.c fts_compat.c
 
@@ -88,27 +94,29 @@
 install: install.binary install.man
 
 install.binary: all
-	mkdir -p $(TARGET)$(BINDIR)
-	mkdir -p $(TARGET)$(LOCAL_ROOT)
-	mkdir -p $(TARGET)$(LOCAL_ROOT)/doc
-	rm -f $(TARGET)$(BINDIR)/polipo
-	cp -f polipo $(TARGET)$(BINDIR)/
-	cp -f html/* $(TARGET)$(LOCAL_ROOT)/doc
-	cp -f localindex.html $(TARGET)$(LOCAL_ROOT)/index.html
+	install -d $(DESTDIR)$(BINDIR)
+	install -d $(DESTDIR)$(DISK_CACHE_ROOT)
+	install -d $(DESTDIR)$(LOCAL_ROOT)/doc
+	rm -f $(DESTDIR)$(BINDIR)/$(PKGNAME)
+	install polipo $(DESTDIR)$(BINDIR)
+	install html/* $(DESTDIR)$(LOCAL_ROOT)/doc
+	install localindex.html $(DESTDIR)$(LOCAL_ROOT)/index.html
 
 install.man: all
-	mkdir -p $(TARGET)$(MANDIR)/man1
-	mkdir -p $(TARGET)$(INFODIR)
-	cp -f polipo.man $(TARGET)$(MANDIR)/man1/polipo.1
-	cp polipo.info $(TARGET)$(INFODIR)/
-	install-info --info-dir=$(INFODIR) polipo.info
-
+	install -d $(DESTDIR)$(MANDIR)/man1
+	install -d $(DESTDIR)$(INFODIR)
+	install -D polipo.man $(DESTDIR)$(MANDIR)/man1/polipo.1
+	install polipo.info $(DESTDIR)$(INFODIR)
+
+install.info: all
+	install -d polipo.info $(DESTDIR)$(INFODIR)
+	install-info --info-dir=$(DESTDIR)$(INFODIR) polipo.info
 
 polipo.info: polipo.texi
 	makeinfo polipo.texi
 
 html/index.html: polipo.texi
-	mkdir -p html
+	install -d html
 	makeinfo --html -o html polipo.texi
 
 polipo.html: polipo.texi
