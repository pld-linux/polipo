--- polipo-0.9.10/Makefile~	2006-09-19 10:34:04.152129305 +0300
+++ polipo-0.9.10/Makefile	2006-09-19 10:36:01.794774951 +0300
@@ -1,9 +1,18 @@
 PREFIX = /usr/local
 BINDIR = $(PREFIX)/bin
-MANDIR = $(PREFIX)/man
-INFODIR = $(PREFIX)/info
-LOCAL_ROOT = /usr/share/polipo/www
-DISK_CACHE_ROOT = /var/cache/polipo
+DATADIR = $(PREFIX)/share
+MANDIR = $(DATADIR)/man
+INFODIR = $(DATADIR)/info
+LOCAL_ROOT = $(DATADIR)/polipo/www
+LOCALSTATEDIR = /var
+DISK_CACHE_ROOT = $(LOCALSTATEDIR)/cache/polipo
+DESTDIR = 
+
+# for /usr/sbin/install-info
+PATH += :/usr/sbin
+  
+CC = cc
+CFLAGS = -O2 -Wall
 
 # CDEBUGFLAGS = -O
 
@@ -11,7 +20,7 @@
 
 # CC = gcc
 # CDEBUGFLAGS = -O -g -Wall -std=gnu99
-CDEBUGFLAGS = -O -g -Wall
+# CDEBUGFLAGS = -O -g -Wall
 # CDEBUGFLAGS = -Os -Wall
 # CDEBUGFLAGS = -g -Wall
 
@@ -45,9 +37,7 @@
 #      gethostbyname/getaddrinfo when DNS requests fail.
 #  -DNO_TUNNEL to compile out the code that handles CONNECT requests.
 
-DEFINES = $(FILE_DEFINES) $(PLATFORM_DEFINES)
-
-CFLAGS = $(MD5INCLUDES) $(CDEBUGFLAGS) $(DEFINES) $(EXTRA_DEFINES)
+DEFINES += $(FILE_DEFINES) $(PLATFORM_DEFINES)
 
 SRCS = util.c event.c io.c chunk.c atom.c object.c log.c diskcache.c main.c \
        config.c local.c http.c client.c server.c auth.c tunnel.c \
@@ -60,7 +50,7 @@
        md5import.o ftsimport.o \
 
 polipo: $(OBJS)
-	$(CC) $(CFLAGS) $(LDFLAGS) -o polipo $(OBJS) $(MD5LIBS) $(LDLIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) $(MD5INCLUDES) $(DEFINES) $(EXTRA_DEFINES) -o polipo $(OBJS) $(MD5LIBS) $(LDLIBS)
 
 ftsimport.o: ftsimport.c fts_compat.c
 
@@ -68,30 +58,33 @@
 
 all: polipo polipo.info html/index.html localindex.html
 
-install: install.binary install.man
+install: install.binary install.man install.info
 
 install.binary: all
-	mkdir -p $(TARGET)$(BINDIR)
-	mkdir -p $(TARGET)$(LOCAL_ROOT)
-	mkdir -p $(TARGET)$(LOCAL_ROOT)/doc
-	rm -f $(TARGET)$(BINDIR)/polipo
-	cp -f polipo $(TARGET)$(BINDIR)/
-	cp -f html/* $(TARGET)$(LOCAL_ROOT)/doc
-	cp -f localindex.html $(TARGET)$(LOCAL_ROOT)/index.html
+	install -d $(DESTDIR)$(BINDIR)
+	install -d $(DESTDIR)$(LOCAL_ROOT)
+	install -d $(DESTDIR)$(LOCAL_ROOT)/doc
+	install -d $(DESTDIR)$(DISK_CACHE_ROOT)
+	rm -f $(DESTDIR)$(BINDIR)/polipo
+	install polipo $(DESTDIR)$(BINDIR)/
+	install localindex.html $(DESTDIR)$(LOCAL_ROOT)/index.html
+	install html/* $(DESTDIR)$(LOCAL_ROOT)/doc
 
 install.man: all
-	mkdir -p $(TARGET)$(MANDIR)/man1
-	mkdir -p $(TARGET)$(INFODIR)
-	cp -f polipo.man $(TARGET)$(MANDIR)/man1/polipo.1
-	cp polipo.info $(TARGET)$(INFODIR)/
-	install-info --info-dir=$(INFODIR) polipo.info
+	install -d $(DESTDIR)$(MANDIR)/man1
+	install -d $(DESTDIR)$(INFODIR)
+	install -D polipo.man $(DESTDIR)$(MANDIR)/man1/polipo.1
+
+install.info: all
+	install polipo.info $(DESTDIR)$(INFODIR)
+       	install-info --info-dir=$(DESTDIR)$(INFODIR) polipo.info
 
 
 polipo.info: polipo.texi
 	makeinfo polipo.texi
 
 html/index.html: polipo.texi
-	mkdir -p html
+	install -d html
 	makeinfo --html -o html polipo.texi
 
 polipo.html: polipo.texi
